// =============================================================================
// Enums
// =============================================================================

enum TicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_ON_CLIENT
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

// =============================================================================
// Models
// =============================================================================

model Ticket {
  id           String @id @default(cuid())
  ticketNumber Int    @unique

  subject  String
  status   TicketStatus   @default(OPEN)
  priority TicketPriority @default(NORMAL)
  category String?

  clientId       String
  client         Client  @relation(fields: [clientId], references: [id])
  relatedClaimId String?
  relatedClaim   Claim?  @relation(fields: [relatedClaimId], references: [id])

  reporterId   String?
  reporter     User?   @relation("TicketReporter", fields: [reporterId], references: [id])
  createdById  String
  createdBy    User    @relation("TicketCreator", fields: [createdById], references: [id])
  assignedToId String?
  assignedTo   User?   @relation("TicketAssignee", fields: [assignedToId], references: [id])

  closedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages TicketMessage[]

  @@index([clientId])
  @@index([relatedClaimId])
  @@index([reporterId])
  @@index([createdById])
  @@index([assignedToId])
  @@index([status])
  @@index([priority])
  @@index([category])
  @@index([createdAt])
  @@map("tickets")
}

model TicketMessage {
  id String @id @default(cuid())

  message String

  ticketId String
  ticket   Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ticketId])
  @@index([authorId])
  @@index([createdAt])
  @@map("ticket_messages")
}
